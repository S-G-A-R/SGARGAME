@page "/nivel1"
@inject IJSRuntime JS

<link href="css/juego.css" rel="stylesheet" />

<div class="nivel1-container">
    <div class="header">
        <div class="header-left">
            <span class="app-title">SGAR GAME</span>
            <h2 class="titulo-nivel-pequeno">♻️ Categoría 2: Ordena y recicla</h2>
        </div>
        <a href="/MenuCategorias" class="understand-button map-button-header">MAPA DE CATEGORIAS</a>
    </div>

    <div class="hud">
        <div class="hud-item">
            <span class="hud-label">Puntos</span>
            <span class="hud-value">@puntos</span>
        </div>
        <div class="hud-item">
            <span class="hud-label">Vidas</span>
            <span class="hud-value">@vidas</span>
        </div>
        <div class="hub">
            <div style="margin-bottom: 10px;">
                <label for="cantidadObjetos">Cantidad de bjetos:</label>
                <select @bind="cantidadObjetosSeleccionada" id="cantidadObjetos" class="hud-select" style="padding: 5px; border-radius: 5px;">
                    <option value="1">1 Objeto (Fácil)</option>
                    <option value="2">2 Objetos (Normal)</option>
                    <option value="3">3 Objetos (Difícil)</option>
                    <option value="4">4 Objetos (Experto)</option>
                </select>
            </div>
        </div>
    </div>

    @if (!JuegoListo)
    {
        <p style="color: #fff; background-color: #f87171; padding: 5px 10px; border-radius: 5px; margin-top: 10px;">
            ⚠️ Selecciona la cantidad de objetos antes de iniciar.
        </p>
    }

    <div id="gameArea">
        <!-- El canvas puede estar aquí o será creado por JS si no existe -->
        <canvas id="gameCanvas" width="800" height="500"></canvas>
        <!-- Los botes los crea el JS dinámicamente dentro de #gameArea -->
    </div>

    <div class="botones">
        <button @onclick="IniciarJuego" class="btn-iniciar">
            🚀 Iniciar Juego
        </button>
    </div>
</div>

<!-- carga el script al final del componente para asegurarnos que el DOM exista -->
<script src="css/juego.js" rel="stylesheet"></script>

@code {
    private int puntos = 0;
    private int vidas = 3;
    // Nueva variable para la selección del usuario
    private int cantidadObjetosSeleccionada = 0; // Valor inicial

    private bool JuegoListo => cantidadObjetosSeleccionada > 0;

    private async Task IniciarJuego()
    {
        puntos = 0;
        vidas = 3;
        StateHasChanged();
        // Llamamos al JS; JS se encargará de crear botes si hacen falta
        await JS.InvokeVoidAsync("iniciarJuego", DotNetObjectReference.Create(this), cantidadObjetosSeleccionada);
    }

    [JSInvokable]
    public async Task AumentarPuntos()
    {
        puntos += 1;
        StateHasChanged();

        if (puntos % 50 == 0)
        {
            await JS.InvokeVoidAsync("aumentarVelocidad");
        }
    }

    [JSInvokable]
    public async Task PerderVida()
    {
        vidas--;
        StateHasChanged();

        if (vidas <= 0)
        {
            await JS.InvokeVoidAsync("terminarJuego", puntos);
        }
    }
}

